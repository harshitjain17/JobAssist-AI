{% extends "base.html" %}

{% block title %}{{ consumer.name }} - Consumer Details{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
    }
    .contact-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    .contact-item i {
        width: 1.5rem;
        color: #6c757d;
    }
    .status-badge {
        font-size: 0.9rem;
    }
    .ai-card {
        border-left: 4px solid #6f42c1;
    }
    .timeline-item {
        position: relative;
        padding-left: 2.5rem;
        padding-bottom: 1.5rem;
        border-left: 2px dashed #dee2e6;
        margin-left: 1rem;
    }
    .timeline-item:last-child {
        border-left: none;
    }
    .timeline-icon {
        position: absolute;
        left: -1rem;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        background-color: #fff;
        border: 2px solid #dee2e6;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .timeline-icon.success {
        border-color: #28a745;
        color: #28a745;
    }
    .timeline-icon.primary {
        border-color: #007bff;
        color: #007bff;
    }
    .timeline-icon.warning {
        border-color: #ffc107;
        color: #ffc107;
    }
    .timeline-icon.info {
        border-color: #17a2b8;
        color: #17a2b8;
    }
    .skill-badge {
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h1 class="h3">Consumer Profile</h1>
        <div>
            <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#aiAssistModal">
                <i class="fas fa-robot me-1"></i> AI Assist
            </button>
            <div class="btn-group">
                <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fas fa-plus me-1"></i> Action
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addNoteModal">
                        <i class="fas fa-sticky-note me-2"></i> Add Note
                    </a></li>
                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#addAppointmentModal">
                        <i class="fas fa-calendar-plus me-2"></i> Schedule Appointment
                    </a></li>
                    <li><a class="dropdown-item" href="#">
                        <i class="fas fa-file-alt me-2"></i> Generate Report
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="#">
                        <i class="fas fa-user-times me-2"></i> Deactivate Consumer
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Left column: Consumer info -->
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body p-0">
                <div class="profile-header p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            {{ consumer.name[0] }}
                        </div>
                        <div>
                            <h2 class="h4 mb-1">{{ consumer.name }}</h2>
                            <span class="badge bg-{{ 'success' if consumer.status == 'Active' else 'warning' if consumer.status == 'Job placement' else 'secondary' }} status-badge">
                                {{ consumer.status }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="p-4 border-bottom">
                    <h3 class="h5 mb-3"><i class="fas fa-id-card me-2 text-primary"></i>Contact Information</h3>
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>{{ consumer.email }}</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <span>{{ consumer.phone }}</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ consumer.address }}</span>
                    </div>
                    <div class="mt-3">
                        <h6>Emergency Contact</h6>
                        <div class="ps-3">
                            <div>{{ consumer.emergency_contact.name }} ({{ consumer.emergency_contact.relation }})</div>
                            <div class="text-muted small">{{ consumer.emergency_contact.phone }}</div>
                        </div>
                    </div>
                </div>

                <div class="p-4 border-bottom">
                    <h3 class="h5 mb-3"><i class="fas fa-user-tag me-2 text-primary"></i>Demographics</h3>
                    <div class="row">
                        <div class="col-6">
                            <div class="mb-2">
                                <small class="text-muted d-block">Age</small>
                                {{ consumer.age }}
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-2">
                                <small class="text-muted d-block">Disability Type</small>
                                {{ consumer.disability }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-4">
                    <h3 class="h5 mb-3"><i class="fas fa-tools me-2 text-primary"></i>Skills & Interests</h3>
                    <div class="mb-3">
                        <small class="text-muted d-block mb-2">Skills</small>
                        {% for skill in consumer.skills %}
                            <span class="badge bg-light text-dark border skill-badge">{{ skill }}</span>
                        {% endfor %}
                    </div>
                    <div>
                        <small class="text-muted d-block mb-2">Job Interests</small>
                        {% for interest in consumer.job_interests %}
                            <span class="badge bg-light text-dark border skill-badge">{{ interest }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right column: Tabs for notes, appointments, etc. -->
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <ul class="nav nav-tabs card-header-tabs" id="consumerTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab">
                            <i class="fas fa-sticky-note me-2"></i>Case Notes
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="appointments-tab" data-bs-toggle="tab" data-bs-target="#appointments" type="button" role="tab">
                            <i class="fas fa-calendar me-2"></i>Appointments
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab">
                            <i class="fas fa-file-alt me-2"></i>Documents
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs" type="button" role="tab">
                            <i class="fas fa-briefcase me-2"></i>Job Matches
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="consumerTabContent">
                    <!-- Notes Tab -->
                    <div class="tab-pane fade show active" id="notes" role="tabpanel" aria-labelledby="notes-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="h5 mb-0">Case Notes</h4>
                            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addNoteModal">
                                <i class="fas fa-plus me-1"></i> Add Note
                            </button>
                        </div>
                        
                        <div class="timeline">
                            {% if notes %}
                                {% for note in notes|sort(attribute='date', reverse=True) %}
                                    <div class="timeline-item">
                                        <div class="timeline-icon {{ 'success' if note.category == 'Job Offer' else 'primary' if note.category == 'Progress' else 'info' }}">
                                            <i class="fas {{ 'fa-check' if note.category == 'Job Offer' else 'fa-tasks' if note.category == 'Progress' else 'fa-search' if note.category == 'Job Lead' else 'fa-sticky-note' }}"></i>
                                        </div>
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="badge bg-{{ 'success' if note.category == 'Job Offer' else 'primary' if note.category == 'Progress' else 'info' if note.category == 'Job Lead' else 'secondary' }}">
                                                        {{ note.category }}
                                                    </span>
                                                    <small class="text-muted">{{ note.date }}</small>
                                                </div>
                                                <p class="card-text">{{ note.content }}</p>
                                                <div class="d-flex justify-content-between">
                                                    <small class="text-muted">By: {{ users[note.coach_id].name }}</small>
                                                    <div>
                                                        <button class="btn btn-sm btn-link text-muted p-0">
                                                            <i class="fas fa-pencil-alt"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-link text-danger p-0 ms-2">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center text-muted my-5">
                                    <i class="fas fa-sticky-note fa-3x mb-3"></i>
                                    <p>No case notes yet.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Appointments Tab -->
                    <div class="tab-pane fade" id="appointments" role="tabpanel" aria-labelledby="appointments-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="h5 mb-0">Scheduled Appointments</h4>
                            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addAppointmentModal">
                                <i class="fas fa-plus me-1"></i> Schedule
                            </button>
                        </div>
                        
                        {% if appointments %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Title</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Time</th>
                                            <th scope="col">Location</th>
                                            <th scope="col">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for appointment in appointments|sort(attribute='date') %}
                                            <tr>
                                                <td>{{ appointment.title }}</td>
                                                <td>{{ appointment.date }}</td>
                                                <td>{{ appointment.time }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'primary' if appointment.location == 'Office' else 'success' if appointment.location == 'Virtual' else 'warning' }}">
                                                        {{ appointment.location }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger ms-1">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center text-muted my-5">
                                <i class="fas fa-calendar fa-3x mb-3"></i>
                                <p>No appointments scheduled.</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Documents Tab -->
                    <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="h5 mb-0">Documents</h4>
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-upload me-1"></i> Upload
                            </button>
                        </div>
                        
                        <div class="text-center text-muted my-5">
                            <i class="fas fa-file-alt fa-3x mb-3"></i>
                            <p>No documents uploaded yet.</p>
                        </div>
                    </div>
                    
                    <!-- Job Matches Tab -->
                    <div class="tab-pane fade" id="jobs" role="tabpanel" aria-labelledby="jobs-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="h5 mb-0">Potential Job Matches</h4>
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-sync me-1"></i> Refresh Matches
                            </button>
                        </div>
                        
                        <!-- AI-recommended jobs would go here -->
                        <div class="card mb-3 ai-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bg-light rounded-circle p-2 me-3">
                                        <i class="fas fa-building text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title mb-0">Data Entry Specialist</h5>
                                        <p class="card-subtitle text-muted">Acme Corporation</p>
                                    </div>
                                    <div class="ms-auto">
                                        <span class="badge bg-success">95% Match</span>
                                    </div>
                                </div>
                                <p class="card-text">Remote position with flexible hours perfect for someone with mobility challenges. Requires attention to detail and proficiency in MS Office.</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-light text-dark border me-1">Remote</span>
                                        <span class="badge bg-light text-dark border me-1">Full-time</span>
                                        <span class="badge bg-light text-dark border">Entry Level</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary">Apply</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-3 ai-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bg-light rounded-circle p-2 me-3">
                                        <i class="fas fa-building text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title mb-0">Customer Support Representative</h5>
                                        <p class="card-subtitle text-muted">TechServe Inc.</p>
                                    </div>
                                    <div class="ms-auto">
                                        <span class="badge bg-success">87% Match</span>
                                    </div>
                                </div>
                                <p class="card-text">Work-from-home position answering customer inquiries via email and chat. Company provides full accessibility accommodations.</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-light text-dark border me-1">Remote</span>
                                        <span class="badge bg-light text-dark border me-1">Part-time</span>
                                        <span class="badge bg-light text-dark border">Customer Service</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary">Apply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Appointment Modal -->
<div class="modal fade" id="addAppointmentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Schedule Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="appointmentTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="appointmentTitle">
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label for="appointmentDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="appointmentDate">
                        </div>
                        <div class="col">
                            <label for="appointmentTime" class="form-label">Time</label>
                            <input type="time" class="form-control" id="appointmentTime">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="appointmentLocation" class="form-label">Location</label>
                        <select class="form-select" id="appointmentLocation">
                            <option value="Office">Office</option>
                            <option value="Virtual">Virtual</option>
                            <option value="Employer Site">Employer Site</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="appointmentNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="appointmentNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Appointment</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Note Modal -->
<div class="modal fade" id="addNoteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Case Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="noteCategory" class="form-label">Category</label>
                        <select class="form-select" id="noteCategory">
                            <option value="Progress">Progress</option>
                            <option value="Job Lead">Job Lead</option>
                            <option value="Job Offer">Job Offer</option>
                            <option value="Concern">Concern</option>
                            <option value="General">General</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="noteContent" class="form-label">Note Content</label>
                        <textarea class="form-control" id="noteContent" rows="5"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Note</button>
            </div>
        </div>
    </div>
</div>

<!-- AI Assist Modal -->
<div class="modal fade" id="aiAssistModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-robot me-2"></i> AI Assistant
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <div class="form-floating">
                        <textarea class="form-control" id="aiPrompt" style="height: 100px"></textarea>
                        <label for="aiPrompt">Ask a question about this consumer...</label>
                    </div>
                    <div class="d-flex justify-content-end mt-2">
                        <button type="button" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-1"></i> Send
                        </button>
                    </div>
                </div>
                
                <div class="card bg-light">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Suggested queries:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-sm btn-outline-secondary">What job types match James's skills?</button>
                            <button class="btn btn-sm btn-outline-secondary">Generate a progress report for James</button>
                            <button class="btn btn-sm btn-outline-secondary">Suggest accommodations for mobility limitations</button>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="card ai-card">
                    <div class="card-body">
                        <div class="d-flex mb-3">
                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px; font-size: 1.2rem;">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">AI Assistant</h6>
                                <small class="text-muted">Just now</small>
                            </div>
                        </div>
                        
                        <p>Based on James's profile, I recommend exploring remote data entry positions. His skills in data entry and MS Office align well with these roles, which typically accommodate mobility limitations through remote work arrangements.</p>
                        
                        <p>Here are some specific actions you might consider:</p>
                        
                        <ul>
                            <li>Review his resume to ensure his data entry skills are prominently featured</li>
                            <li>Consider scheduling a skills assessment to quantify his typing speed and accuracy</li>
                            <li>Reach out to Acme Corporation about their remote data entry position that opened recently</li>
                        </ul>
                        
                        <p>Would you like me to help draft an email to Acme Corporation or prepare questions for a skills assessment?</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}